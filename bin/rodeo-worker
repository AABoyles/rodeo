#!/bin/sh

if uname -a | grep Darwin > /dev/null; then
    RODEO_DIR=~/repos/yhat/prototypes/rodeo-native
else
    RODEO_DIR=/var/rodeo
fi

case "$1" in

    start)
        # this will ventually be an init call
        node "${RODEO_DIR}/src/server/server.js" $2
    ;;

    restart)
        # this will ventually be an init call
        for pid in $(ps ax | grep "${RODEO_DIR}/src/server/server.js" | awk '{ print $1 }')
          do
            kill $pid
          done
        # this will ventually be an init call
        node "${RODEO_DIR}/src/server/server.js" $2
    ;;

    stop)
        # this will ventually be an init call
        for pid in $(ps ax | grep "${RODEO_DIR}/src/server/server.js" | awk '{ print $1 }')
          do
            kill $pid
          done
    ;;

    version)
        echo "RodeoServer v$(cat "${RODEO_DIR}/package.json" | jq -r .version)"
    ;;
    
    *)
        echo "Usage: rodeo-worker {start|stop|restart|version}"
        exit 2

esac
