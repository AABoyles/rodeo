var path=require("path");var fs=require("fs");function getCurrentLine(editor){return editor.session.getLine(editor.getCursorPosition().row)}function setDefaultPreferences(editor){var rc=getRC();if(rc.keyBindings=="default"){rc.keyBindings=null}editor.setKeyboardHandler(rc.keyBindings||null);editor.setTheme(rc.editorTheme||"ace/theme/chrome");editor.setFontSize(rc.fontSize||12);if(rc.autoSave){editor.on("input",function(){saveEditor()})}}function createEditor(id){track("rodeo","editor");var langTools=ace.require("ace/ext/language_tools");var Autocomplete=ace.require("ace/autocomplete").Autocomplete;var editor=ace.edit(id);editor.completer=new Autocomplete(editor);editor.setTheme("ace/theme/chrome");editor.getSession().setMode("ace/mode/python");editor.setOptions({showPrintMargin:false,enableBasicAutocompletion:true,enableSnippets:false,enableLiveAutocompletion:false});editor.$blockScrolling=Infinity;var pythonCompleter={getCompletions:function(editor,session,pos,prefix,fn){session.$mode.$keywordList=[];var code=getCurrentLine(editor);var payload={id:uuid.v4(),code:code,complete:true};callbacks[payload.id]=function(result){var predictions=result.output.map(function(p){return{name:p.text,value:p.text,score:100,meta:p.dtype}});fn(null,predictions)};python.stdin.write(JSON.stringify(payload)+"\n")}};langTools.addCompleter(pythonCompleter);editor.commands.addCommand({name:"showPreferences",bindKey:{win:"ctrl-,",mac:"Command-,"},exec:function(editor){showPreferences()}});editor.commands.addCommand({name:"findFile",bindKey:{win:"ctrl-t",mac:"Command-t"},exec:function(editor){findFile()}});editor.commands.addCommand({name:"sendCommand",bindKey:{win:"ctrl-Enter",mac:"Command-Enter"},exec:function(editor){var text=editor.getCopyText();var currline=editor.getSelectionRange().end.row;if(text==""){text=editor.session.getLine(currline)}jqconsole.Write(">>> "+text+"\n","jqconsole-old-input");jqconsole.SetHistory(jqconsole.GetHistory().concat([text]));sendCommand(text);editor.gotoLine(currline+2,10,true)}});editor.commands.addCommand({name:"saveFile",bindKey:{win:"ctrl-s",mac:"Command-s"},exec:function(editor){saveEditor(editor)}});editor.commands.addCommand({name:"autocomplete",bindKey:{win:"tab",mac:"tab"},exec:function(editor){var pos=editor.getCursorPosition();var text=editor.session.getTextRange({start:{row:pos.row,column:pos.column-1},end:{row:pos.row,column:pos.column}});var line=getCurrentLine(editor);if(/from /.test(line)||/import /.test(line)){editor.completer.showPopup(editor)}else if(text!=" "&&text!=""){editor.completer.showPopup(editor)}else{editor.insert("    ")}}});editor.on("input",function(){$("#"+id.replace("editor","editor-tab")+" .unsaved").removeClass("hide")});setDefaultPreferences(editor)}var msg="IPython -- An enhanced Interactive Python.\n";msg+="?         -> Introduction and overview of IPython's features.\n";msg+="%quickref -> Quick reference.\n";msg+="help      -> Python's own help system.\n";msg+="object?   -> Details about 'object', use 'object??' for extra details.\n";var jqconsole=$("#console").jqconsole(msg,">>> ");function startPrompt(){jqconsole.Prompt(true,function(input){sendCommand(input);startPrompt()})}startPrompt();jqconsole.SetIndentWidth(4);jqconsole.RegisterShortcut("l",function(){jqconsole.Clear()});jqconsole.RegisterShortcut("a",function(){jqconsole.MoveToStart()});jqconsole.RegisterShortcut("e",function(){jqconsole.MoveToEnd()});jqconsole.RegisterShortcut("c",function(){jqconsole.ClearPromptText()});jqconsole.RegisterShortcut("u",function(){var text=jqconsole.GetPromptText().slice(jqconsole.GetColumn()-4);jqconsole.SetPromptText(text)});jqconsole.RegisterShortcut("k",function(){var text=jqconsole.GetPromptText().slice(0,jqconsole.GetColumn()-4);jqconsole.SetPromptText(text)});jqconsole.RegisterShortcut("w",function(){var idx=jqconsole.GetColumn()-4;var text=jqconsole.GetPromptText().trim();var lidx=text.slice(0,idx).lastIndexOf(" ");if(lidx==-1){lidx=0}text=text.slice(0,lidx)+" "+text.slice(idx+1);text=text.trim();jqconsole.SetPromptText(text)});jqconsole._IndentOld=jqconsole._Indent;jqconsole._Indent=function(){if(jqconsole.GetPromptText().trim()==""){jqconsole._IndentOld()}else if(jqconsole.GetPromptText().slice(-1)=="\n"){jqconsole._IndentOld()}else{var originalPrompt=jqconsole.GetPromptText();var code=jqconsole.GetPromptText();jqconsole.ClearPromptText(true);var payload={id:uuid.v4(),code:code,complete:true};callbacks[payload.id]=function(result){var predictions=result.output;var completedText="";if(predictions.length==1){var prediction=predictions[0].value;for(var i=prediction.length;i>0;i--){var p=prediction.slice(0,i);if(originalPrompt.slice(-p.length)==p){completedText=originalPrompt+prediction.slice(i);break}}jqconsole.SetPromptText(completedText);return}var widthChars=$("#console").width()/6.4;var longestString=20;var nCols=Math.round(widthChars/(longestString+5),0);var table=new AsciiTable;var row=[];for(var i=0;i<predictions.length;i++){var text;if(!predictions[i]){return}if(code.slice(-1)=="."){text=code+predictions[i].text}else{text=predictions[i].text}row.push(text);if(row.length==nCols){table.addRow(row);row=[]}}if(row.length>0){table.addRow(row)}table.removeBorder().setJustify();jqconsole.Write(table.render()+"\n\n","jqconsole-output");startPrompt();jqconsole.SetPromptText(originalPrompt)};python.stdin.write(JSON.stringify(payload)+"\n")}};global.$=$;var remote=require("remote");var Menu=remote.require("menu");var BrowserWindow=remote.require("browser-window");var MenuItem=remote.require("menu-item");var shell=require("shell");var path=require("path");var colors=require("colors");var fs=require("fs");var fse=require("fs-extra");var uuid=require("uuid");var walk=require("walk");var tmp=require("tmp");var SteveIrwin=require(path.join(__dirname,"/../src/steve-irwin"));var USER_WD=USER_HOME;var variableWindow;var spawn=require("child_process").spawn;var StreamSplitter=require("stream-splitter");var delim="\n";global.callbacks={};var pythonKernel=path.join(__dirname,"../src","kernel.py");var kernelFile=tmp.fileSync();fse.copySync(pythonKernel,kernelFile.name);fs.chmodSync(kernelFile.name,493);var configFile=tmp.fileSync();var python;SteveIrwin.findMeAPython(function(err,pythonCmd){if(pythonCmd==null||err){var params={toolbar:false,resizable:true,show:true,height:800,width:1e3};var badPythonWindow=new BrowserWindow(params);badPythonWindow.loadUrl("file://"+__dirname+"/../static/bad-python.html");badPythonWindow.webContents.on("did-finish-load",function(){badPythonWindow.webContents.send("ping",{pythonCmds:pythonCmds})});return}python=spawn(pythonCmd,[kernelFile.name,configFile.name+".json",delim]);python.stderr.on("data",function(data){console.log(data.toString().yellow)});python.on("error",function(err){console.log(err.toString())});python.on("exit",function(code){fs.unlink(kernelFile.name,function(err){if(err){console.log("failed to remove temporary kernel file: "+err)}});console.log("exited with code: "+code)});python.on("close",function(code){console.log("closed with code: "+code)});python.on("disconnect",function(){console.log("disconnected")});python.stdout.pipe(StreamSplitter(delim)).on("token",function(data){var result=JSON.parse(data.toString());if(result.id in callbacks){callbacks[result.id](result);delete callbacks[result.id]}else{console.log("[ERROR]: "+"callback not found for: "+result.id+" --> "+JSON.stringify(result))}});refreshVariables();refreshPackages();setFiles(USER_WD)});function refreshVariables(){var payload={id:uuid.v4(),code:"__get_variables()"};callbacks[payload.id]=function(result){if(!result.output){$("#vars").children().remove();console.error("[ERROR]: Result from code execution was null.");return}var variables=JSON.parse(result.output);$("#vars").children().remove();variables.forEach(function(v){$("#vars").append(active_variables_row_template({name:v.name,type:v.dtype}))}.bind(this));$("#vars tr").first().children().each(function(i,el){$($("#vars-header th")[i]).css("width",$(el).css("width"))})};python.stdin.write(JSON.stringify(payload)+delim)}function refreshPackages(){var payload={id:uuid.v4(),code:"__get_packages()"};callbacks[payload.id]=function(result){var packages=JSON.parse(result.output);$("#packages-rows").children().remove();packages.forEach(function(p){$("#packages-rows").append(package_row_template({name:p.name,version:p.version}))})};python.stdin.write(JSON.stringify(payload)+delim)}function sendCommand(input,hideResult){track("rodeo","command");if(python==null){jqconsole.Write("Could not execute command. Python is still starting up. This should only take another couple seconds.\n","jqconsole-error");return}if(/^\?/.test(input)){input="help("+input.slice(1)+")"}var html=history_row_template({n:$("#history-trail").children().length,command:input});$("#history-trail").append(html);$cont=$("#history-trail").parent();$cont[0].scrollTop=$cont[0].scrollHeight;var payload={id:uuid.v4(),code:input};callbacks[payload.id]=function(result){if(/^help[(]/.test(input)){$("#help-content").text(result.output);$('a[href="#help"]').tab("show");return}else{if(hideResult==true){return}if(result.image){var plotImage="data:image/png;charset=utf-8;base64,"+result.image;$("#plots .active").removeClass("active").addClass("hide");$("#plots").append('<img class="active" style="max-height: 100%; max-width: 100%;" src="'+plotImage+'" />');$('a[href="#plot-window"]').tab("show");calibratePanes()}jqconsole.Write((result.output||"")+"\n")}if(result.error){track("rodeo","command","error");jqconsole.Write(result.error+"\n","jqconsole-error")}refreshVariables()};python.stdin.write(JSON.stringify(payload)+delim)}function showAbout(){var params={toolbar:false,resizable:false,show:true,height:500,width:800};var aboutWindow=new BrowserWindow(params);aboutWindow.loadUrl("file://"+__dirname+"/../static/about.html")}function showPreferences(){var rc=getRC();rc.keyBindings=rc.keyBindings||"default";rc.defaultWd=rc.defaultWd||USER_HOME;rc.trackingOn=rc.trackingOn||true;if($("#editor-tab-preferences").length){$("#editor-tab-"+"preferences"+" .editor-tab-a").click();return}$("#editor-tab-"+"preferences"+" .editor-tab-a").click();var editor_tab_html=editor_tab_template({n:"preferences",name:"Preferences"});var preferences_html=preferences_template(rc);$(editor_tab_html).insertBefore($("#add-tab").parent());$("#editors").append(preferences_html);$("#editor-tab-"+"preferences"+" .editor-tab-a").click();$('[data-toggle="tooltip"]').tooltip()}function showVariable(varname,type){var params={toolbar:false,resizable:true,show:true,height:800,width:1e3};variableWindow=new BrowserWindow(params);variableWindow.loadUrl("file://"+__dirname+"/../static/display-variable.html");var show_var_statements={DataFrame:"print("+varname+"[:1000].to_html())",list:"pp.pprint(%s)"%varname};variableWindow.webContents.on("did-finish-load",function(){var payload={id:uuid.v4(),code:show_var_statements[type]};callbacks[payload.id]=function(result){variableWindow.webContents.send("ping",{type:type,html:result.output})};python.stdin.write(JSON.stringify(payload)+delim)});variableWindow.on("close",function(){variableWindow=null})}function showPlot(){if(!$("img.active").length){return}var filename=$("img.active").attr("src");var params={toolbar:false,resizable:false,show:true,height:1e3,width:1e3};var plotWindow=new BrowserWindow(params);plotWindow.loadUrl(filename)}function savePlot(){if(!$("img.active").length){return}remote.require("dialog").showSaveDialog({title:"Export Plot",default_path:USER_WD},function(destfile){if(!destfile){return}var img=$("img.active").attr("src").replace("data:image/png;charset=utf-8;base64,","");fs.writeFile(destfile,img,"base64",function(err){if(err){return console.error(err)}})})}function saveEditor(editor,saveas,fn){saveas=saveas||false;var id=$($("#editorsTab .active a").attr("href")+" .editor").attr("id");if(!editor){editor=ace.edit(id)}var filename=$("#editorsTab .active a").text();var content=editor.getSession().getValue();if(!$("#editorsTab .active a").attr("data-filename")||saveas==true){remote.require("dialog").showSaveDialog({title:"Save File",default_path:USER_WD},function(destfile){if(!destfile){if(fn){return fn()}return}$("#editorsTab .active a").text(path.basename(destfile));$("#editorsTab .active a").attr("data-filename",destfile);fs.writeFileSync(destfile,content);$("#"+id.replace("editor","editor-tab")+" .unsaved").addClass("hide");setFiles();if(fn){fn()}})}else{fs.writeFileSync($("#editorsTab .active a").attr("data-filename"),content);$("#"+id.replace("editor","editor-tab")+" .unsaved").addClass("hide");setFiles();if(fn){fn()}}}function openFile(pathname){if($("#editorsTab a[data-filename='"+pathname+"']").length){$("#editorsTab a[data-filename='"+pathname+"']").click();return}else if(fs.lstatSync(pathname).isDirectory()){var directory=pathname;setFiles(pathname)}else{var filename=pathname;var basename=path.basename(filename);$("#add-tab").click();$("#editorsTab li:nth-last-child(2) .name").text(basename);$("#editorsTab li:nth-last-child(2) a").attr("data-filename",filename);var id=$("#editors .editor").last().attr("id");var editor=ace.edit(id);fs.readFile(filename,function(err,data){if(err){console.error("[ERROR]: could not open file: "+filename);return}editor.getSession().setValue(data.toString());$("#editorsTab li:nth-last-child(2) a").click();setTimeout(function(){$("#"+id.replace("editor","editor-tab")+" .unsaved").addClass("hide")},50)})}}function openDialog(){remote.require("dialog").showOpenDialog({title:"Open File",default_path:USER_WD},function(files){if(files){files.forEach(function(filename){openFile(filename)})}})}var walker;function setFiles(dir){if(python==null){return}dir=dir||USER_WD;USER_WD=dir;var payload={id:uuid.v4(),code:"cd "+dir};callbacks[payload.id]=function(result){};python.stdin.write(JSON.stringify(payload)+"\n");var files=fs.readdirSync(dir);$("#file-list").children().remove();$("#working-directory").children().remove();$("#working-directory").append(wd_template({dir:dir.replace(USER_HOME,"~")}));$("#file-list").append(file_template({isDir:true,filename:formatFilename(path.join(dir,"..")),basename:".."}));var rc=getRC();files.forEach(function(f){var filename=formatFilename(path.join(dir,f));if(!fs.lstatSync(filename).isDirectory()){return}if(rc.displayDotFiles!=true){if(/\/\./.test(dir)||/^\./.test(f)){return}}$("#file-list").append(file_template({isDir:fs.lstatSync(filename).isDirectory(),filename:filename,basename:f}))}.bind(this));files.forEach(function(f){var filename=formatFilename(path.join(dir,f));if(fs.lstatSync(filename).isDirectory()){return}if(rc.displayDotFiles!=true){if(/\/\./.test(dir)||/^\./.test(f)){return}}$("#file-list").append(file_template({isDir:fs.lstatSync(filename).isDirectory(),filename:filename,basename:f}))}.bind(this));if(walker){walker.pause();delete walker}walker=walk.walk(USER_WD,{followLinks:false});$("#file-search-list .list").children().remove();walker.on("file",function(root,stat,next){var dir=root.replace(USER_WD,"")||"";var displayFilename=path.join(dir,stat.name).replace(/^\//,"");if(rc.displayDotFiles!=true){if(/\/\./.test(dir)||/^\./.test(stat.name)){return next()}}var fullFilename=formatFilename(path.join(root,stat.name));var onclick='$("#file-search-list .selected").removeClass("selected"); $(this).addClass("selected"); $("#file-search-form").submit();';$("#file-search-list .list").append("<li onclick='"+onclick+"' data-filename='"+fullFilename+"'><a class='filename'>"+displayFilename+"</a></li>");next()});walker.on("end",function(){indexFiles()})}function pickDirectory(title,defaultPath,fn){remote.require("dialog").showOpenDialog({title:title,properties:["openDirectory"],defaultPath:defaultPath},function(dir){fn(dir)})}function pickWorkingDirectory(fn){pickDirectory("Select a Working Directory",USER_WD,function(wd){if(!wd){return}var wd=wd[0];setFiles(wd)})}function addFolderToWorkingDirectory(newdir){var dirpath=path.join(USER_WD,newdir);fs.mkdir(dirpath,function(err){if(err){console.error("[ERROR]: could not create directory: "+dirpath)}else{setFiles(USER_WD)}})}function setConsoleWidth(w){var code="pd.set_option('display.width', "+w+")";sendCommand(code,true)}function findFile(){$("#file-search-modal").unbind();$("#file-search-modal").modal("show");$("#file-search-modal input").focus();$("#file-search-modal").keydown(function(e){var selectedFile=$("#file-search-list .list .selected").data("filename");if(!fileList){return}var nextFile;if(e.which==40){for(var i=0;i<fileList.matchingItems.length-1;i++){if($(fileList.matchingItems[i].elm).data("filename")==selectedFile){nextFile=$(fileList.matchingItems[i+1].elm).data("filename");break}}if(!nextFile){nextFile=$(fileList.matchingItems[0].elm).data("filename")}}else if(e.which==38){for(var i=fileList.matchingItems.length-1;i>0;i--){if($(fileList.matchingItems[i].elm).data("filename")==selectedFile){nextFile=$(fileList.matchingItems[i-1].elm).data("filename");break}}if(!nextFile){nextFile=$(fileList.matchingItems[fileList.matchingItems.length-1].elm).data("filename")}}$("#file-search-list .list li").each(function(i,el){if($(el).data("filename")==nextFile){$("#file-search-list .list .selected").removeClass("selected");$(el).addClass("selected");var $parentDiv=$("#file-search-list ul");var $innerListItem=$(el);$parentDiv.scrollTop($parentDiv.scrollTop()+$innerListItem.position().top-$parentDiv.height()/1.5+$innerListItem.height()/3)}})})}var path=require("path");var fs=require("fs");function setEditorTheme(theme){$(".editor").each(function(i,item){var editor=ace.edit(item.id);editor.setTheme(theme)});updateRC("editorTheme",theme)}function setKeyBindings(binding){$(".editor").each(function(i,item){var editor=ace.edit(item.id);if(binding=="default"){binding=null}editor.setKeyboardHandler(binding)});updateRC("keyBindings",binding)}function setFontSize(size){size=parseInt(size);$(".editor").each(function(i,item){var editor=ace.edit(item.id);editor.setFontSize(size)});updateRC("fontSize",size)}function setDefaultWd(wd){updateRC("defaultWd",wd)}function setTheme(theme){if(fs.existsSync(path.join(__dirname,"..","static",theme))){if($("#rodeo-theme").attr("href")!=theme){$("#rodeo-theme").attr("href",theme)}}updateRC("theme",theme)}function setPythonCmd(cmd){if(cmd){cmd=cmd.replace("~",USER_HOME);updateRC("pythonCmd",cmd)}else{updateRC("pythonCmd",null)}}function setAutoSave(val){updateRC("autoSave",val)}function setDisplayDotFiles(val){updateRC("displayDotFiles",val)}function setTracking(val){updateRC("trackingOn",val)}var rc=getRC();if(rc.defaultWd&&fs.existsSync(rc.defaultWd)){USER_WD=rc.defaultWd}else{USER_WD=USER_HOME}if(rc.theme){setTheme(rc.theme)}var remote=require("remote");var fs=require("fs");var path=require("path");var rimraf=require("rimraf");var webFrame=require("web-frame");var dialogs=require("dialogs")({url:"../static/img/cowboy-hat.svg"});var Menu=remote.require("menu");var template=[{label:"Rodeo",submenu:[{label:"About Rodeo",click:function(){showAbout()}},{type:"separator"},{label:"Preferences",accelerator:"CmdOrCtrl+,",click:function(){showPreferences();track("rodeo","shortcut","Preferences")}},{type:"separator"},{label:"Hide Rodeo",accelerator:"CmdOrCtrl+H",selector:"hide:"},{label:"Hide Others",accelerator:"CmdOrCtrl+Shift+H",selector:"hideOtherApplications:"},{label:"Show All",selector:"unhideAllApplications:"},{type:"separator"},{label:"Quit",accelerator:"CmdOrCtrl+Q",selector:"terminate:"}]},{label:"File",submenu:[{label:"New",accelerator:"CmdOrCtrl+N",click:function(){track("rodeo","shortcut","New");$("#add-tab").click()}},{label:"Open",accelerator:"Shift+CmdOrCtrl+O",click:function(){track("rodeo","shortcut","Open");openDialog()}},{type:"separator"},{label:"Save",accelerator:"CmdOrCtrl+s",click:function(){track("rodeo","shortcut","Save");saveEditor()}},{label:"Save As",click:function(){track("rodeo","shortcut","Save As");saveEditor(null,true)}},{type:"separator"},{label:"Close File",accelerator:"CmdOrCtrl+w",click:function(){if(variableWindow&&variableWindow.isFocused()){variableWindow.close()}else{if($("#editorsTab .active").length){var n=$("#editorsTab .active").attr("id").replace("editor-tab-","");closeActiveTab(n)}}track("rodeo","shortcut","Close File")}},{type:"separator"},{label:"Find File",accelerator:"CmdOrCtrl+t",click:function(){track("rodeo","shortcut","Find File");findFile()}}]},{label:"Edit",submenu:[{label:"Undo",accelerator:"Command+Z",selector:"undo:"},{label:"Redo",accelerator:"Shift+Command+Z",selector:"redo:"},{type:"separator"},{label:"Cut",accelerator:"Command+X",selector:"cut:"},{label:"Copy",accelerator:"Command+C",selector:"copy:"},{label:"Paste",accelerator:"Command+V",selector:"paste:"},{label:"Select All",accelerator:"Command+A",selector:"selectAll:"}]},{label:"View",submenu:[{label:"Change Editor",submenu:[{label:"Move One Left",accelerator:"CmdOrCtrl+Shift+Left",click:function(){track("rodeo","shortcut","Change Editor > Move One Left");var prevTab=$("#editorsTab .active").prev();if(prevTab&&$("a",prevTab).attr("href")!="#"){$("a",prevTab).click()}}},{label:"Move One Right",accelerator:"CmdOrCtrl+Shift+Right",click:function(){track("rodeo","shortcut","Change Editor > Move One Right");var nextTab=$("#editorsTab .active").next();if(nextTab&&$("a",nextTab).attr("href")!="#"){$("a",nextTab).click()}}}]},{label:"Focus",submenu:[{label:"Editor",accelerator:"CmdOrCtrl+1",click:function(){track("rodeo","shortcut","Focus > Editor");var id=$("#editors .active .editor").attr("id");var editor=ace.edit(id);editor.focus()}},{label:"Console",accelerator:"CmdOrCtrl+2",click:function(){track("rodeo","shortcut","Focus > Console");jqconsole.Focus()}},{label:"Variables/History",accelerator:"CmdOrCtrl+3",click:function(){track("rodeo","shortcut","Focus > Variables/History");var next=$("#top-right .nav .active").next();if(!$(next).length){next=$("#top-right .nav li").first()}$("a",next).click()}},{label:"Files/Plots/Packages/Help",accelerator:"CmdOrCtrl+4",click:function(){track("rodeo","shortcut","Focus > Files/Plots/Pacakges/Help");var next=$("#bottom-right .nav .active").next();if(!$(next).length){next=$("#bottom-right .nav li").first()}$("a",next).click()}}]},{label:"Reload",accelerator:"CmdOrCtrl+R",click:function(){track("rodeo","shortcut","Reload");remote.getCurrentWindow().reload()}},{label:"Toggle Dev Tools",accelerator:"Alt+CmdOrCtrl+I",click:function(){remote.getCurrentWindow().toggleDevTools()}}]},{label:"Window",submenu:[{label:"Minimize",accelerator:"CmdOrCtrl+M",selector:"performMiniaturize:"},{label:"Zoom",submenu:[{label:"Zoom to Default",accelerator:"CmdOrCtrl+0",click:function(){track("rodeo","shortcut","Zoom > Default");webFrame.setZoomLevel(0);calibratePanes()}},{label:"Zoom In",accelerator:"CmdOrCtrl+=",click:function(){track("rodeo","shortcut","Zoom > Zoom In");webFrame.setZoomLevel(webFrame.getZoomLevel()+1);calibratePanes()}},{label:"Zoom Out",accelerator:"CmdOrCtrl+-",click:function(){track("rodeo","shortcut","Zoom > Zoom Out");webFrame.setZoomLevel(webFrame.getZoomLevel()-1);calibratePanes()}}]},{type:"separator"},{label:"Bring All to Front",selector:"arrangeInFront:"}]},{label:"Session",submenu:[{label:"Restart Session",click:function(){track("rodeo","shortcut","Session > Restart Session");remote.require("dialog").showMessageBox({type:"warning",buttons:["Yes","Cancel"],message:"Are you sure you want to restart your Python session?",detail:"Your data and variables will be deleted permanently."},function(reply){if(reply==0){sendCommand("%reset -f",false);refreshVariables()}else return})}},{label:"Set Working Directory",click:function(){track("rodeo","shortcut","Session > Set Working Directory");pickWorkingDirectory()}},{label:"Run Previous Command",submenu:[{label:"2nd to Last",accelerator:"CmdOrCtrl+Shift+2",click:function(){track("rodeo","shortcut","Session > Run Previous Command > 2nd to Last");sendCommand($("#history-trail").children().slice(-2,-1).text())}},{label:"Last",accelerator:"CmdOrCtrl+Shift+1",click:function(){track("rodeo","shortcut","Session > Run Previous Command > Last");sendCommand($("#history-trail").children().slice(-1).text())}}]}]},{label:"Help",submenu:[]}];menu=Menu.buildFromTemplate(template);Menu.setApplicationMenu(menu);var template=[{label:"Change Working Directory",click:function(){pickWorkingDirectory()}},{label:"Add Folder",click:function(){dialogs.prompt("Enter a name for your new folder: ",function(dirname){if(dirname){addFolderToWorkingDirectory(dirname)}})}}];fileMenu=Menu.buildFromTemplate(template);var template=[{label:"Delete",click:function(){dialogs.confirm("Are you sure you want to delete "+path.basename(folderMenu.filename)+"? This will remove all files and directories within this folder.",function(ok){if(ok){rimraf(folderMenu.filename,function(err){if(err){console.error("[ERROR]: Could not delete: "+folderMenu.filename)}else{setFiles(USER_WD)}})}})}}];folderMenu=Menu.buildFromTemplate(template);
